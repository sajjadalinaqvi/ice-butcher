<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ice Sculpture Chatbot</title>
  <style>
    /* Minimal sleek styling */
    :root {
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7dd3fc;
      --muted:#94a3b8;
    }
    body {
      background:linear-gradient(180deg,#071027 0%, #07162a 100%);
      color:#e6eef8;
      font-family:Inter,ui-sans-serif,system-ui,Arial;
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
    }
    .container {
      width:920px;
      max-width:95%;
      background:radial-gradient(ellipse at top left, rgba(255,255,255,0.02), transparent),var(--card);
      border-radius:18px;
      padding:18px;
      box-shadow:0 10px 30px rgba(2,6,23,0.7);
    }
    h1 {
      margin:0 0 12px 0;
      font-size:20px;
    }
    .chat {
      height:520px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:12px;
      padding:14px;
      display:flex;
      flex-direction:column;
    }
    .messages {
      flex:1;
      overflow:auto;
      padding-right:8px;
    }
    .msg {
      margin:10px 0;
      display:flex;
    }
    .user {
      align-self:flex-end;
      background:linear-gradient(90deg,#173a5a,#0ea5e9);
      padding:10px 12px;
      border-radius:12px 12px 4px 12px;
      max-width:78%;
    }
    .bot {
      align-self:flex-start;
      background:rgba(255,255,255,0.03);
      padding:10px 12px;
      border-radius:12px 12px 12px 4px;
      max-width:78%;
      color:var(--muted);
    }
    .controls {
      display:flex;
      gap:8px;
      margin-top:12px;
    }
    input[type=text] {
      flex:1;
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:inherit;
    }
    button {
      padding:10px 14px;
      border-radius:10px;
      border:0;
      background:var(--accent);
      color:#002;
      cursor:pointer;
    }
    img.generated {
      max-width:360px;
      border-radius:8px;
      margin-top:8px;
      display:block;
    }
    .hint {
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ice Sculpture Visualizer</h1>
    <p class="hint">
      Type a prompt (try:
      <em>glass clear ice sculpture of a Chinese dragon, wrapped around a glass clear ice sculpture blossoming cherry tree</em>)
    </p>
    <div class="chat">
      <div class="messages" id="messages"></div>
      <div class="controls">
        <input id="prompt" type="text" placeholder="Describe your ice sculpture..." />
        <button id="send">Generate</button>
      </div>
    </div>
  </div>

  <script>
    const messages = document.getElementById('messages');
    const promptInput = document.getElementById('prompt');
    const send = document.getElementById('send');

    function addMessage(text, cls='bot') {
      const el = document.createElement('div');
      el.className = 'msg ' + (cls === 'user' ? 'user' : 'bot');
      if (cls === 'user') {
        el.textContent = text;
      } else {
        el.innerHTML = text;
      }
      messages.appendChild(el);
      messages.scrollTop = messages.scrollHeight;
    }

    send.onclick = async () => {
      const p = promptInput.value.trim();
      if (!p) return;
      addMessage(p, 'user');
      addMessage('<em>Generating...</em>', 'bot');
      promptInput.value = '';

      try {
        const form = new FormData();
        form.append('prompt', p);
        const res = await fetch('/generate/', { method:'POST', body: form });
        const j = await res.json();

        // remove the last "Generating..." message
        messages.removeChild(messages.lastChild);

        if (j.error) {
          addMessage('<strong>Error:</strong> ' + j.error, 'bot');
          return;
        }

        if (j.image_base64) {
          const img = new Image();
          img.className = 'generated';
          img.src = 'data:image/png;base64,' + j.image_base64;
          const container = document.createElement('div');
          container.className = 'msg bot';
          container.appendChild(img);
          messages.appendChild(container);
          messages.scrollTop = messages.scrollHeight;
        } else {
          addMessage('<strong>Response:</strong> ' + JSON.stringify(j), 'bot');
        }
      } catch (err) {
        messages.removeChild(messages.lastChild);
        addMessage('<strong>Network error:</strong> ' + err.message, 'bot');
      }
    };

    promptInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') send.click();
    });
  </script>
</body>
</html>
